# Архитектура игры Source of Fantasy

## Обзор

Данная игра построена на модульной архитектуре, которая обеспечивает:

- Читаемость кода
- Легкость поддержки и расширения
- Переиспользование компонентов
- Возможность командной разработки

## Структура файлов

```
game/
├── script.rpy              # Главный файл с точкой входа
├── scenes/                 # Сцены игры
│   ├── battle.rpy         # Боевые сцены
│   ├── seduction.rpy      # Сцены соблазнения
│   ├── progression.rpy    # Сцены прокачки
│   ├── dialogue.rpy       # Диалоговые сцены
│   └── exploration.rpy    # Сцены исследования
├── systems/               # Игровые системы
│   ├── battle_system.rpy  # Боевая механика
│   ├── seduction_system.rpy # Система соблазнения
│   ├── progression_system.rpy # Система прокачки
│   └── inventory_system.rpy   # Система инвентаря
├── data/                  # Данные игры
│   ├── characters.rpy     # Определения персонажей
│   ├── items.rpy          # Предметы (заглушка)
│   └── locations.rpy      # Локации
└── utils/                 # Утилиты
    ├── helpers.rpy        # Вспомогательные функции
    └── constants.rpy      # Константы игры
```

## Системы

### 1. Боевая система (BattleSystem)

**Файл:** `systems/battle_system.rpy`

**Основные функции:**

- Управление здоровьем и маной игрока и противника
- Система атак и защиты
- ИИ противника
- Определение результатов боя

**Ключевые методы:**

- `start_battle(enemy_type)` - начало боя
- `player_attack()` - атака игрока
- `player_defend()` - защита игрока
- `enemy_turn()` - ход противника
- `is_battle_over()` - проверка окончания боя

### 2. Система соблазнения (SeductionSystem)

**Файл:** `systems/seduction_system.rpy`

**Основные функции:**

- Управление привязанностью цели
- Система комплиментов и подарков
- Различные типы разговоров
- Расчет шансов успеха

**Ключевые методы:**

- `start_seduction(target_type)` - начало соблазнения
- `compliment(compliment_type)` - сделать комплимент
- `gift(gift_type)` - подарить подарок
- `conversation(topic)` - вести разговор
- `is_seduction_successful()` - проверка успеха

### 3. Система прокачки (ProgressionSystem)

**Файл:** `systems/progression_system.rpy`

**Основные функции:**

- Управление уровнем и опытом
- Система характеристик (сила, ловкость, интеллект, харизма, живучесть)
- Развитие навыков
- Система достижений

**Ключевые методы:**

- `gain_exp(amount)` - получение опыта
- `level_up()` - повышение уровня
- `increase_stat(stat_name)` - увеличение характеристики
- `gain_skill_exp(skill_name, amount)` - опыт навыка
- `unlock_achievement(achievement_id)` - разблокировка достижения

### 4. Система инвентаря (InventorySystem)

**Файл:** `systems/inventory_system.rpy`

**Основные функции:**

- Управление предметами игрока
- Система экипировки
- Торговля
- Использование предметов

**Ключевые методы:**

- `add_item(item_id, quantity)` - добавить предмет
- `use_item(item_id)` - использовать предмет
- `equip_item(item_id)` - экипировать предмет
- `add_gold(amount)` - добавить золото
- `get_equipment_bonuses()` - получить бонусы экипировки

## Сцены

### 1. Боевые сцены (`scenes/battle.rpy`)

Содержит все боевые сцены и меню:

- `battle_scene_goblin` - бой с гоблином
- `battle_scene_orc` - бой с орком
- `battle_scene_troll` - бой с троллем
- `battle_loop` - основной боевой цикл
- `inventory_menu` - меню инвентаря

### 2. Сцены соблазнения (`scenes/seduction.rpy`)

Содержит сцены соблазнения различных персонажей:

- `seduction_merchant_daughter` - соблазнение дочери торговца
- `seduction_noble_lady` - соблазнение благородной леди
- `seduction_tavern_wench` - соблазнение таверной девки
- `seduction_loop` - основной цикл соблазнения

### 3. Сцены прокачки (`scenes/progression.rpy`)

Содержит сцены тренировок и развития:

- `training_ground` - тренировочная площадка
- `training_menu` - меню тренировок
- `stat_allocation` - распределение очков характеристик
- `skills_view` - просмотр навыков

### 4. Диалоговые сцены (`scenes/dialogue.rpy`)

Содержит диалоги с NPC:

- `dialogue_merchant` - диалог с торговцем
- `dialogue_trainer` - диалог с тренером
- `dialogue_wizard` - диалог с магом
- `dialogue_guard` - диалог со стражником

### 5. Сцены исследования (`scenes/exploration.rpy`)

Содержит сцены исследования мира:

- `explore_forest` - исследование леса
- `explore_cave` - исследование пещеры
- `gather_resources` - сбор ресурсов
- `search_treasure` - поиск сокровищ

## Данные

### 1. Персонажи (`data/characters.rpy`)

Определения всех персонажей игры с их характеристиками.

### 2. Локации (`data/locations.rpy`)

Описание всех локаций, их действий и связей.

### 3. Предметы (`data/items.rpy`)

Заглушка для системы предметов (пока предметы определены в `inventory_system.rpy`).

## Утилиты

### 1. Вспомогательные функции (`utils/helpers.rpy`)

Содержит полезные функции:

- `roll_dice(sides)` - бросок костей
- `calculate_success_chance(base_chance, modifiers)` - расчет шанса успеха
- `format_gold(amount)` - форматирование золота
- `get_player_title()` - получение титула игрока
- `calculate_combat_power()` - расчет боевой силы

### 2. Константы (`utils/constants.rpy`)

Содержит все константы игры:

- Версия игры
- Базовые значения характеристик
- Цвета интерфейса
- Типы предметов и редкости
- Сообщения системы

## Лучшие практики

### 1. Модульность

- Каждая система в отдельном файле
- Четкое разделение ответственности
- Минимальные зависимости между модулями

### 2. Переиспользование

- Общие функции в utils
- Константы вынесены в отдельный файл
- Системы можно использовать в разных сценах

### 3. Расширяемость

- Легко добавлять новые противников
- Простое добавление новых предметов
- Гибкая система локаций

### 4. Читаемость

- Понятные имена переменных и функций
- Комментарии к сложным участкам кода
- Логичная структура файлов

## Добавление нового контента

### Новый противник

1. Добавить данные в `battle_system.enemies`
2. Создать сцену в `scenes/battle.rpy`
3. Добавить в меню выбора противников

### Новый предмет

1. Добавить данные в `inventory_system.all_items`
2. Добавить логику использования в `use_item()`
3. Добавить в меню покупки/продажи

### Новая локация

1. Добавить данные в `data/locations.rpy`
2. Создать соответствующие сцены
3. Добавить в систему перемещений

## Советы по разработке

1. **Всегда тестируйте** новые функции перед добавлением
2. **Используйте константы** вместо магических чисел
3. **Добавляйте комментарии** к сложной логике
4. **Следите за балансом** игры при добавлении контента
5. **Обновляйте документацию** при изменении архитектуры

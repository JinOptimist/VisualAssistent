# Система особенностей персонажа

## Обзор

Система особенностей позволяет игрокам настраивать характеристики своего персонажа при создании. Каждая особенность имеет название, описание и стоимость в очках развития.

## Основные компоненты

### TraitsSystem (game/systems/traits_system.rpy)

Основной класс системы особенностей, который управляет:

- Списком всех доступных особенностей
- Выбранными особенностями игрока
- Очками развития
- Логикой выбора и отмены особенностей

### Экраны (game/screens/character_creation_screens.rpy)

- `traits_selection` - основной экран выбора особенностей
- `traits_preview` - экран предварительного просмотра выбранных особенностей

## Механика очков развития

- Игрок начинает с 50 очками развития
- **Положительные особенности** стоят очки (например, "Силач" = 2 очка)
- **Отрицательные особенности** дают дополнительные очки (например, "Дохляк" = +2 очка)
- Можно выбирать любое количество особенностей в рамках доступных очков
- **Стратегия**: выбор отрицательных особенностей позволяет получить больше очков для выбора положительных особенностей

### Примеры работы с очками

1. **Начальное состояние**: 50 очков
2. **Выбор отрицательной особенности "Дохляк"** (-2): 50 + 2 = 52 очка
3. **Выбор ещё одной отрицательной особенности "Балбес"** (-2): 52 + 2 = 54 очка
4. **Выбор положительной особенности "Силач"** (2): 54 - 2 = 52 очка

## Доступные особенности

### Положительные особенности

- **Абсолютный полиглот** (50 очков) - понимание всех языков
- **Силач** (2 очка) - +1 к силе
- **Ловкач** (2 очка) - +1 к ловкости
- **Умник** (2 очка) - +1 к интеллекту
- **Удачник** (2 очка) - +1 к удаче

### Отрицательные особенности

- **Дохляк** (+2 очка) - -1 к силе
- **Слон в посудной лавке** (+2 очка) - -1 к ловкости
- **Балбес** (+2 очка) - -1 к интеллекту
- **Чёрный кот** (+2 очка) - -1 к удаче
- **Простолюдин** (+5 очков) - снижение скорости роста опыта

## Использование в игре

### Создание персонажа

```renpy
label c0_c02_create:
    call screen traits_selection

    if _return == "confirm":
        $ success, message = traits_system.confirm_selection()
        if success:
            call screen traits_preview
```

### Получение информации о персонаже

```python
# Получить выбранные особенности
selected_traits = traits_system.get_selected_traits()

# Получить очки развития
points = traits_system.get_development_points()

# Получить общую стоимость особенностей
total_cost = traits_system.get_total_trait_cost()
```

## Интерфейс

### Экран выбора особенностей

- Отображает все доступные особенности
- Показывает текущие очки развития
- Позволяет выбирать/отменять особенности
- Кнопки: Сбросить, Подтвердить, Отмена

### Экран предварительного просмотра

- Показывает выбранные особенности
- Отображает их описания и стоимость
- Кнопки: Назад, Подтвердить

## Стили

Система использует собственные стили для интерфейса:

- `traits_*` - стили для основного экрана
- `trait_*` - стили для элементов особенностей
- `traits_preview_*` - стили для экрана предварительного просмотра

## Расширение системы

### Добавление новых особенностей

1. Добавить особенность в словарь `all_traits` в `TraitsSystem`
2. Указать название, описание и стоимость
3. При необходимости добавить логику применения эффектов

### Добавление новых экранов

1. Создать новый экран в `character_creation_screens.rpy`
2. Добавить соответствующие стили
3. Интегрировать в процесс создания персонажа

## Интеграция с другими системами

Система особенностей может быть интегрирована с:

- Боевой системой (влияние на характеристики)
- Системой инвентаря (специальные предметы)
- Системой диалогов (особые варианты ответов)
- Системой прогрессии (влияние на опыт)

## Примеры использования

### Применение эффектов особенностей

```python
def apply_trait_effects(character_stats):
    for trait in traits_system.get_selected_traits():
        if "Сила +1" in trait["description"]:
            character_stats["strength"] += 1
        elif "Ловкость -1" in trait["description"]:
            character_stats["agility"] -= 1
```

### Проверка наличия особенности

```python
def has_trait(trait_name):
    for trait in traits_system.get_selected_traits():
        if trait["name"] == trait_name:
            return True
    return False
```

### Стратегии создания персонажа

#### Минималист

- Выбрать только отрицательные особенности для максимального количества очков
- Использовать очки для выбора одной мощной положительной особенности

#### Сбалансированный

- Выбрать 1-2 отрицательные особенности
- Использовать полученные очки для выбора нескольких положительных особенностей

#### Специалист

- Выбрать особенности, усиливающие одну характеристику
- Принять отрицательные особенности в других характеристиках для компенсации

## Тестирование

Система включает комплексные тесты в `tests/test_traits_system.py`, которые проверяют:

- Загрузку всех особенностей
- Корректность работы с очками развития
- Выбор и отмену особенностей
- Комбинированные сценарии использования
- Обработку ошибок

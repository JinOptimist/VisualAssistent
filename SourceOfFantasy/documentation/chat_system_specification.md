# Спецификация системы чата

## Обзор

Система чата предназначена для создания визуальной симуляции разговоров в мессенджерах в рамках визуальной новеллы.

## Компоненты

### 1. ChatMessage (Класс сообщения)

- **sender_name**: Имя отправителя
- **text**: Текст сообщения
- **sender_type**: Тип отправителя ("me", "other", "system")
- **timestamp**: Время отправки
- **alignment**: Выравнивание сообщения (0.0 - слева, 0.5 - центр, 1.0 - справа)
- **bubble_color**: Цвет пузырька сообщения
- **name_color**: Цвет имени отправителя
- **text_color**: Цвет текста сообщения

### 2. ChatSystem (Основная система)

- **messages**: Список всех сообщений
- **is_typing**: Флаг показа индикатора печати
- **typing_duration**: Длительность анимации печати

## Методы ChatSystem

### add_message(sender_name, text, sender_type="other")

Добавляет новое сообщение в чат.

### simulate_typing(sender_name, text, sender_type="other", typing_time=None)

Симулирует печать сообщения с задержкой.

### add_typing_indicator(sender_name)

Показывает индикатор печати.

### remove_typing_indicator()

Убирает индикатор печати.

### clear_messages()

Очищает все сообщения.

## Функции для сценариев

### chat_message(sender_name, text, sender_type="other")

Удобная функция для добавления сообщения.

### chat_typing(sender_name, text, sender_type="other", typing_time=None)

Удобная функция для симуляции печати.

### show_chat()

Показывает экран чата.

### hide_chat()

Скрывает экран чата.

### chat_clear()

Очищает чат.

## Типы отправителей

1. **"me"** - Сообщения игрока (справа, синий цвет)
2. **"other"** - Сообщения других участников (слева, темно-серый)
3. **"system"** - Системные сообщения (по центру, серый)

## Использование в сценариях

```rpy
# Показать чат
$ show_chat()

# Добавить сообщение
$ chat_message("Имя", "Текст сообщения", "other")

# Симулировать печать
$ chat_typing("Имя", "Текст сообщения", "me", 2.0)

# Скрыть чат
$ hide_chat()
```

## Визуальные особенности

- Темный фон в стиле современных мессенджеров
- Пузырьки сообщений с разными цветами
- Индикатор печати с анимированными точками
- Временные метки сообщений
- **Автоматическая прокрутка к последнему сообщению невозможна стандартными средствами Ren'Py**
- При первом открытии чата показывается низ (yinitial 1.0), далее пользователь прокручивает чат вручную
- Можно добавить визуальный индикатор "↓ Новое сообщение ↓" для удобства пользователя

## Файлы системы

- **`game/screens.rpy`** - Экран чата (chat_screen)
- **`game/systems/chat_system.rpy`** - Логика системы чата
- **`game/scenes/c0Createion/c0_creation_intro.rpy`** - Пример использования

## Расширение системы

Система может быть легко расширена дополнительными функциями:

- Эмодзи и стикеры
- Вложения файлов
- Статусы "прочитано"
- Групповые чаты
- Поиск по сообщениям
- Экспорт истории чата
- Визуальный индикатор новых сообщений при необходимости ручной прокрутки

## Ограничения

- **Автоматическая прокрутка к последнему сообщению невозможна стандартными средствами Ren'Py**. Пользователь может прокручивать чат вручную с помощью мыши или тачпада.
- При первом открытии чата область сообщений прокручивается вниз автоматически (yinitial 1.0), но при добавлении новых сообщений автоскролл не происходит.
